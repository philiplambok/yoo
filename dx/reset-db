#!/bin/bash
# Reset database: drop, create, migrate, and seed

# Source common functions
source "$(dirname "$0")/_common"
check_docker

echo "ğŸ—‘ï¸  Resetting database..."
echo "âš ï¸  This will delete ALL existing data!"
echo "ğŸ”„ Process: Drop â†’ Create â†’ Migrate â†’ Seed"
echo ""

# Ask for confirmation
read -p "Are you sure you want to reset the database? (y/N): " confirm
if [[ $confirm != [yY] && $confirm != [yY][eE][sS] ]]; then
    echo "âŒ Database reset cancelled."
    exit 0
fi

echo ""
echo "ğŸ—‘ï¸  Dropping existing database..."
docker-compose -f docker-compose.dev.yml exec app bundle exec rails db:drop

echo ""
echo "ğŸ†• Creating new database..."
docker-compose -f docker-compose.dev.yml exec app bundle exec rails db:create

echo ""
echo "ğŸ”„ Running migrations..."
docker-compose -f docker-compose.dev.yml exec app bundle exec rails db:migrate

echo ""
echo "ğŸŒ± Seeding database..."
docker-compose -f docker-compose.dev.yml exec app bundle exec rails db:seed

echo ""
echo "âœ… Database reset complete! Fresh database with sample data ready."