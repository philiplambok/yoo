#!/bin/bash
# Full environment rebuild: stop, build, start

# Source common functions
source "$(dirname "$0")/_common"
check_docker

echo "ðŸ”„ Performing full environment rebuild..."
echo ""

echo "ðŸ›‘ Stopping containers..."
docker-compose -f docker-compose.dev.yml down

echo ""
echo "ðŸ”¨ Building images (with cache)..."
echo "ðŸ’¡ Use './dx/rebuild --no-cache' for fresh build without cache"
if [ "$1" = "--no-cache" ]; then
    echo "ðŸ§¹ Building without cache..."
    docker-compose -f docker-compose.dev.yml build --no-cache
else
    docker-compose -f docker-compose.dev.yml build
fi

echo ""
echo "ðŸš€ Starting containers..."
docker-compose -f docker-compose.dev.yml up -d

echo ""
echo "âœ… Environment rebuild complete! Run './dx/dev' to start Rails server."