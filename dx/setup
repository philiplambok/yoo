#!/bin/bash
# Setup databases for development and testing

# Source common functions
source "$(dirname "$0")/_common"
check_docker

echo "ðŸ—„ï¸  Setting up databases..."
echo "ðŸ”„ This may take a moment on first run..."
echo ""

echo "ðŸ“Š Setting up development database..."
docker-compose -f docker-compose.dev.yml exec app bash -c "
  bundle exec rails db:create 2>/dev/null || echo '  ðŸ“„ Database already exists'
  bundle exec rails db:migrate
  bundle exec rails db:seed
"

echo ""
echo "ðŸ§ª Setting up test database..."
docker-compose -f docker-compose.dev.yml exec -e RAILS_ENV=test app bash -c "
  bundle exec rails db:create 2>/dev/null || echo '  ðŸ“„ Test database already exists'
  bundle exec rails db:environment:set RAILS_ENV=test 2>/dev/null || true
  bundle exec rails db:schema:load 2>/dev/null || bundle exec rails db:migrate
"

echo ""
echo "âœ… All databases ready!"