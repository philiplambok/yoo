#!/bin/bash
# Run RuboCop linter for code quality checks

# Source common functions
source "$(dirname "$0")/_common"
check_docker

# Check if --fix flag is present and convert to proper RuboCop flag
if [[ "$*" == *"--fix"* ]]; then
    echo "üîß Running RuboCop with auto-fix..."
    echo "üí° This will automatically correct fixable style issues"
    echo "‚ö†Ô∏è  Auto-fix will modify your code files"
    echo ""
    
    # Replace --fix with -a (safe autocorrect)
    RUBOCOP_ARGS="${*/--fix/-a}"
    docker-compose -f docker-compose.dev.yml exec app bundle exec rubocop $RUBOCOP_ARGS
    
    echo ""
    echo "‚úÖ Auto-fix complete! Review changes before committing."
elif [[ "$*" == *"-a"* ]] || [[ "$*" == *"--autocorrect"* ]] || [[ "$*" == *"-A"* ]] || [[ "$*" == *"--autocorrect-all"* ]]; then
    echo "üîß Running RuboCop with auto-correct..."
    echo "üí° This will automatically correct style issues"
    echo "‚ö†Ô∏è  Auto-correct will modify your code files"
    echo ""
    
    docker-compose -f docker-compose.dev.yml exec app bundle exec rubocop "$@"
    
    echo ""
    echo "‚úÖ Auto-correct complete! Review changes before committing."
else
    echo "üîç Running RuboCop linter..."
    echo "üí° This will check code style and quality"
    echo "üîß Use './dx/lint --fix' or './dx/lint -a' to automatically fix issues"
    echo ""
    
    docker-compose -f docker-compose.dev.yml exec app bundle exec rubocop "$@"
    
    echo ""
    echo "‚úÖ Linting complete!"
fi